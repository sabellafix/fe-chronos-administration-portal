<div *ngIf="!loading" class="card-body p-0 pb-1 pt-3">
    <div *ngIf="!bookings || bookings.length === 0" class="text-center text-muted py-3">
        <i class="bx bx-info-circle me-2"></i>No hay reservas asignadas aún
    </div>
    <div class="bookings-container">
        <ol class="activity-checkout mb-0 mt-2 ps-3">
            <li *ngFor="let booking of bookings; let i = index" 
                class="checkout-item crypto-activity bg-white rounded rounded-start-0 p-3 ps-5 pb-2 mt-2"
                [class.expanded]="isExpanded(booking.id)"
                [style.border-left]="'2px solid ' +  booking.services?.[0]?.color">
                <div class="crypto-date p-3 me-2 bg-light rounded">
                    <h6 class="text-uppercase font-size-11 mb-0 text-muted">{{booking.bookingDate | monthName}}</h6>
                    <h5 class="font-size-15 mb-0 mt-1">{{booking.bookingDate | dayNumber}}</h5>
                </div>
                <div class="avatar checkout-icon p-1">
                    <div class="avatar-title rounded-circle bg-gradient"
                    [ngStyle]="{'background-color': booking.services?.[0]?.color || '#23324d'}">
                        <i class="bx bx-radio-circle text-white font-size-20"></i>
                    </div>
                </div>
                <div class="feed-item-list">
                    <!-- Contenido principal clickeable -->
                    <div class="d-flex cursor-pointer" (click)="toggleExpand(booking.id)">
                        <div class="flex-grow-1 overflow-hidden me-4">
                            <h5 class="font-size-14 mb-1 text-truncate">{{booking.services?.[0] ? booking.services?.[0]?.serviceName : 'N/A'}}</h5>
                            <p class="text-truncate text-muted mb-0">{{booking.customer ? (booking.customer.firstName + ' ' + booking.customer.lastName) : 'N/A'}}</p>
                        </div>
                        <div class="flex-grow-1 overflow-hidden me-4">
                            <h5 class="mb-1 font-size-14 text-success">{{booking.totalPrice | currency}}</h5>
                            <p class="text-muted mb-0">{{booking.currency}}</p>
                        </div>
                        <div class="flex-shrink-0 text-end me-4">
                            <h5 class="font-size-14 mb-1 text-truncate">{{booking.durationMinutes}} min</h5>
                            <p class="text-truncate text-muted mb-0">{{formatTime(booking.startTime)}} - {{formatTime(booking.endTime)}}</p>
                        </div>
                        <div class="flex-shrink-0 text-end menu-button mt-1 cursor-pointer">
                            <i class="bx text-muted font-size-26 transition-all" [ngClass]="getChevronClass(booking.id)"></i>
                        </div>
                    </div>
                    
                    <!-- Contenido expandible -->
                    <div class="collapse" [class.show]="isExpanded(booking.id)" [id]="'collapse-' + booking.id">
                        <div class="mt-3 pt-3 border-top">
                            <!-- Línea de tiempo de servicios -->
                            <div class="row mb-4" *ngIf="booking.services && booking.services.length > 0">
                                <div class="col-12">
                                    <div class="timeline-container">
                                        <div class="timeline-scroll">
                                            <div class="timeline-wrapper">
                                                <!-- Línea horizontal principal -->
                                                <div class="timeline-line"></div>
                                                
                                                <div class="timeline-points">
                                                    <div 
                                                        *ngFor="let service of booking.services; let i = index"
                                                        class="timeline-point"
                                                        [style.left.%]="booking.services.length === 1 ? 50 : (i / (booking.services.length - 1)) * 100">
                                                        
                                                        <div class="service-name">
                                                            {{service.serviceName || 'Servicio ' + (i + 1)}}
                                                        </div>
                                                        
                                                        <!-- Icono del punto -->
                                                        <div class="service-icon" [style.background-color]="service.color || '#007bff'">
                                                            <i class="bx bx-circle text-white"></i>
                                                        </div>
                                                        
                                                        <!-- Horario (abajo) -->
                                                        <div class="service-time text-muted">
                                                            <small>{{formatTime(booking.startTime)}}</small>
                                                            <small class="d-block">{{formatTime(booking.endTime)}}</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
        </ol>
    </div>
</div>

<div *ngIf="loading" class="text-center py-3">
    <ngx-skeleton-loader [count]="10" [theme]="{ 'border-radius': '10', height: '50px', 'background-color': '#FFFFFFF' }"></ngx-skeleton-loader>
</div>